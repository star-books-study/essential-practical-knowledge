# Chapter 02.
## 처리량과 응답시간
### 응답시간
- 응답 시간 : 사용자 요청을 처리하는 데 걸리는 시간
  - API 요청 (서버에 연결, 서버로 데이터 전송)
  - 서버 실행 
  - API 응답 (클라이언트로 데이터 전송)
- 응답시간은 2가지로 나누어 측정하기도 함
  - TTFB (Time To First Byte) : 응답 데이터 중 첫번째 바이트가 도착할 때까지 걸린 시간
  - TTLB (Time To Last Byte) : 응답 데이터 중 마지막 바이트가 도착할 때까지 걸린 시간
- 응답데이터 크기가 작다면 TTFB, TTLB 차이가 크지 않지만, 파일 다운로드처럼 전송할 데이터 크기가 크거나, 네트워크 속도가 느릴 경우 차이가 커질 수 있다
  - **데이터 특성, 네트워크 환경을 고려**하여 적절한 지표를 선택하여 측정해야 한다

### 처리량
- 처리량 : 단위 시간 당 시스템이 처리하는 작업량
  - TPS, RPS
- 응답시간을 개선하기 위해서는
  - 서버가 동시에 처리할 수 있는 **요청 수를 늘려서** 대기 시간 줄이기
  - **처리 시간 자체를 줄여서** 대기 시간 줄이기 
- 성능을 개선하려면 **현재 서버의 TPS 와 응답시간을 알아야 한다** -> 모니터링 시스템 활용
  - 더욱 정확한 TPS 를 알고 싶다면 웹 서버 접근 로그를 활용하면 된다 (엘라스틱 서치 활용하여 접근 로그 수집 및 집계)

## 서버 성능 개선 기초
### 병목 지점
- 트래픽 증가하며 성능 문제가 발생하는 주된 이유는, **시스템이 수용할 수 있는 최대 TPS 를 초과하는 트래픽이 유입되기 때문**
- 문제 지점 찾기 : 처리 시간이 오래 걸리는 작업 식별하기

### 수직 확장과 수평 확장
- TPS 를 높이기 위해 무턱대고 서버를 추가해선 안되고, 실제 병목 지점 파악이 필요하다
  - DB 에 문제가 있는데, DB 를 사용하는 서버를 더 늘리면 (스케일 아웃), DB 에 가해지는 부하가 더욱 커진다
- **DB 나 외부 API 에 성능 문제가 발생하지 않는 범위 내에서만 수평 확장을 해야 효과가 있다**

### DB 커넥션 풀
- DB 사용하기 위한 3단계
  - DB 에 연결
  - 쿼리 실행
  - 사용이 끝나면 연결 종료
- 매 요청마다 DB 를 연결하고 종료하면, 트래픽 증가 시 급격히 처리량이 떨어진다 -> `DB 커넥션 풀`로 해결
  - DB 에 연결된 커넥션을 미리 생성해서 보관한다
  - 애플리케이션은 DB 작업이 필요할 때 풀에서 커넥션을 가져와 사용하고, 작업이 끝나면 다시 풀에 반환한다
<br> -> 커넥션 풀 사용 시, **이미 연결된 커넥션을 재사용하기에 응답시간이 줄어든다**

### 커넥션 풀 크기
- 커넥션 풀 크기 : 커넥션 풀에 미리 생성해둘 커넥션 개수 지정하는 설정